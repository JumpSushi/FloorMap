{
  "version": 3,
  "sources": ["../../remix-themes/build/useBroadcastChannel.js", "../../remix-themes/build/useCorrectCssTransition.js", "../../remix-themes/build/theme-provider.js"],
  "sourcesContent": ["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useBroadcastChannel = void 0;\nconst react_1 = require(\"react\");\nfunction useBroadcastChannel(channelName, handleMessage, handleMessageError) {\n    const channelRef = (0, react_1.useRef)(typeof window !== 'undefined' && 'BroadcastChannel' in window\n        ? new BroadcastChannel(channelName + '-channel')\n        : null);\n    useChannelEventListener(channelRef, 'message', handleMessage);\n    useChannelEventListener(channelRef, 'messageerror', handleMessageError);\n    return (0, react_1.useCallback)((data) => {\n        var _a;\n        (_a = channelRef === null || channelRef === void 0 ? void 0 : channelRef.current) === null || _a === void 0 ? void 0 : _a.postMessage(data);\n    }, [channelRef]);\n}\nexports.useBroadcastChannel = useBroadcastChannel;\nfunction useChannelEventListener(channelRef, event, handler = () => { }) {\n    (0, react_1.useEffect)(() => {\n        const channel = channelRef.current;\n        if (channel) {\n            channel.addEventListener(event, handler);\n            return () => channel.removeEventListener(event, handler);\n        }\n    }, [channelRef, event, handler]);\n}\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useCorrectCssTransition = void 0;\nconst react_1 = require(\"react\");\nfunction withoutTransition(callback) {\n    const css = document.createElement('style');\n    css.appendChild(document.createTextNode(`* {\n       -webkit-transition: none !important;\n       -moz-transition: none !important;\n       -o-transition: none !important;\n       -ms-transition: none !important;\n       transition: none !important;\n    }`));\n    document.head.appendChild(css);\n    callback();\n    setTimeout(() => {\n        // Calling getComputedStyle forces the browser to redraw\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const _ = window.getComputedStyle(css).transition;\n        document.head.removeChild(css);\n    }, 0);\n}\nfunction useCorrectCssTransition({ disableTransitions = false, } = {}) {\n    return (0, react_1.useCallback)((callback) => {\n        if (disableTransitions) {\n            withoutTransition(() => {\n                callback();\n            });\n        }\n        else {\n            callback();\n        }\n    }, [disableTransitions]);\n}\nexports.useCorrectCssTransition = useCorrectCssTransition;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.isTheme = exports.useTheme = exports.PreventFlashOnWrongTheme = exports.ThemeProvider = exports.mediaQuery = exports.themes = exports.Theme = void 0;\nconst jsx_runtime_1 = require(\"react/jsx-runtime\");\nconst react_1 = require(\"react\");\nconst useBroadcastChannel_1 = require(\"./useBroadcastChannel\");\nconst useCorrectCssTransition_1 = require(\"./useCorrectCssTransition\");\nvar Theme;\n(function (Theme) {\n    Theme[\"DARK\"] = \"dark\";\n    Theme[\"LIGHT\"] = \"light\";\n})(Theme = exports.Theme || (exports.Theme = {}));\nexports.themes = Object.values(Theme);\nconst ThemeContext = (0, react_1.createContext)(undefined);\nThemeContext.displayName = 'ThemeContext';\nconst prefersLightMQ = '(prefers-color-scheme: light)';\nconst getPreferredTheme = () => window.matchMedia(prefersLightMQ).matches ? Theme.LIGHT : Theme.DARK;\nexports.mediaQuery = typeof window !== 'undefined' ? window.matchMedia(prefersLightMQ) : null;\nfunction ThemeProvider({ children, specifiedTheme, themeAction, disableTransitionOnThemeChange = false, }) {\n    const ensureCorrectTransition = (0, useCorrectCssTransition_1.useCorrectCssTransition)({\n        disableTransitions: disableTransitionOnThemeChange,\n    });\n    const [theme, setTheme] = (0, react_1.useState)(() => {\n        // On the server, if we don't have a specified theme then we should\n        // return null and the clientThemeCode will set the theme for us\n        // before hydration. Then (during hydration), this code will get the same\n        // value that clientThemeCode got so hydration is happy.\n        if (specifiedTheme) {\n            return exports.themes.includes(specifiedTheme) ? specifiedTheme : null;\n        }\n        // there's no way for us to know what the theme should be in this context\n        // the client will have to figure it out before hydration.\n        if (typeof window !== 'object')\n            return null;\n        return getPreferredTheme();\n    });\n    const [themeDefinedBy, setThemeDefinedBy] = (0, react_1.useState)(specifiedTheme ? 'USER' : 'SYSTEM');\n    const broadcastThemeChange = (0, useBroadcastChannel_1.useBroadcastChannel)('remix-themes', e => {\n        ensureCorrectTransition(() => {\n            setTheme(e.data.theme);\n            setThemeDefinedBy(e.data.definedBy);\n        });\n    });\n    (0, react_1.useEffect)(() => {\n        if (themeDefinedBy === 'USER') {\n            return () => { };\n        }\n        const handleChange = (ev) => {\n            ensureCorrectTransition(() => {\n                setTheme(ev.matches ? Theme.LIGHT : Theme.DARK);\n            });\n        };\n        exports.mediaQuery === null || exports.mediaQuery === void 0 ? void 0 : exports.mediaQuery.addEventListener('change', handleChange);\n        return () => exports.mediaQuery === null || exports.mediaQuery === void 0 ? void 0 : exports.mediaQuery.removeEventListener('change', handleChange);\n    }, [ensureCorrectTransition, themeDefinedBy]);\n    const handleThemeChange = (0, react_1.useCallback)(value => {\n        const nextTheme = typeof value === 'function' ? value(theme) : value;\n        if (nextTheme === null) {\n            const preferredTheme = getPreferredTheme();\n            ensureCorrectTransition(() => {\n                setTheme(preferredTheme);\n                setThemeDefinedBy('SYSTEM');\n                broadcastThemeChange({ theme: preferredTheme, definedBy: 'SYSTEM' });\n            });\n            fetch(`${themeAction}`, {\n                method: 'POST',\n                body: JSON.stringify({ theme: null }),\n            });\n        }\n        else {\n            ensureCorrectTransition(() => {\n                setTheme(nextTheme);\n                setThemeDefinedBy('USER');\n                broadcastThemeChange({ theme: nextTheme, definedBy: 'USER' });\n            });\n            fetch(`${themeAction}`, {\n                method: 'POST',\n                body: JSON.stringify({ theme: nextTheme }),\n            });\n        }\n    }, [broadcastThemeChange, ensureCorrectTransition, theme, themeAction]);\n    const value = (0, react_1.useMemo)(() => [theme, handleThemeChange, { definedBy: themeDefinedBy }], [theme, handleThemeChange, themeDefinedBy]);\n    return (0, jsx_runtime_1.jsx)(ThemeContext.Provider, { value: value, children: children });\n}\nexports.ThemeProvider = ThemeProvider;\nconst clientThemeCode = String.raw `\n(() => {\n  const theme = window.matchMedia(${JSON.stringify(prefersLightMQ)}).matches\n    ? 'light'\n    : 'dark';\n  \n  const cl = document.documentElement.classList;\n  const dataAttr = document.documentElement.dataset.theme;\n\n  if (dataAttr != null) {\n    const themeAlreadyApplied = dataAttr === 'light' || dataAttr === 'dark';\n    if (!themeAlreadyApplied) {\n      document.documentElement.dataset.theme = theme;\n    }\n  } else {\n    const themeAlreadyApplied = cl.contains('light') || cl.contains('dark');\n    if (!themeAlreadyApplied) {\n      cl.add(theme);\n    }\n  }\n  \n  const meta = document.querySelector('meta[name=color-scheme]');\n  if (meta) {\n    if (theme === 'dark') {\n      meta.content = 'dark light';\n    } else if (theme === 'light') {\n      meta.content = 'light dark';\n    }\n  }\n})();\n`;\nfunction PreventFlashOnWrongTheme({ ssrTheme, nonce, }) {\n    const [theme] = useTheme();\n    return ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [(0, jsx_runtime_1.jsx)(\"meta\", { name: \"color-scheme\", content: theme === 'light' ? 'light dark' : 'dark light' }), ssrTheme ? null : ((0, jsx_runtime_1.jsx)(\"script\", { \n                // NOTE: we cannot use type=\"module\" because that automatically makes\n                // the script \"defer\". That doesn't work for us because we need\n                // this script to run synchronously before the rest of the document\n                // is finished loading.\n                dangerouslySetInnerHTML: { __html: clientThemeCode }, nonce: nonce, suppressHydrationWarning: true }))] }));\n}\nexports.PreventFlashOnWrongTheme = PreventFlashOnWrongTheme;\nfunction useTheme() {\n    const context = (0, react_1.useContext)(ThemeContext);\n    if (context === undefined) {\n        throw new Error('useTheme must be used within a ThemeProvider');\n    }\n    return context;\n}\nexports.useTheme = useTheme;\nfunction isTheme(value) {\n    return typeof value === 'string' && exports.themes.includes(value);\n}\nexports.isTheme = isTheme;\n"],
  "mappings": "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",
  "names": ["Theme", "value"]
}
